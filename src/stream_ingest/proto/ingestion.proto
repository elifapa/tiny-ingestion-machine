syntax = "proto3";

// option java_multiple_files = true;
// option java_package = "io.grpc.examples.helloworld";
// option java_outer_classname = "HelloWorldProto";
// option objc_class_prefix = "HLW";

package ingestion;

// The Broker service definition.
service Broker {
  // Pulls a message from the broker. Used by Consumer.
  rpc PullMessage (PullRequest) returns (stream PullResponse) {}
  // Pushes a new message to the broker. Used by Producer.
  rpc PushMessage (PushRequest) returns (PushResponse) {}
  // Adds topic to the broker. Used by Admin.
  rpc AddTopic (AddTopicRequest) returns (AddTopicResponse) {}
  rpc ListTopics (ListTopicsRequest) returns (ListTopicsResponse) {}
}

// The request for PushMessage action, containing the event message.
message PushRequest {
  string topic_name = 1;
  int32 partition_id = 2;     // Optional
  string payload = 3;
  int64 timestamp = 4;
}
// The response for PushMessage action, containing the success status.
message PushResponse {
  bool success = 1;
  string message = 2;
}
// The request for PullMessage action, containing the number of requested messages.
message PullRequest {
//   int32 offset = 1;
  string topic_name = 1;
  int32 number_of_messages = 2;
}
// The response for PullMessage action, containing the event message.
message PullResponse {
  string topic_name = 1;
  string id = 2;
  string payload = 3;
  int64 timestamp = 4;
}
// The request for AddTopic action, containing the topic name.
message AddTopicRequest {
  string topic_name = 1;
  int32 partition_count = 2;
  int32 replication_factor = 3;
}
// The response for AddTopic action, containing the success status.
message AddTopicResponse {
  bool success = 1;
  string message = 2;
}
// Topic metadata.
message Topic {
  string name = 1;
  int32 partition_count = 2;
  int32 replication_factor = 3;
  int64 created_at = 4;
}
// The request for ListTopics action.
message ListTopicsRequest {
}
// The response for ListTopics action, containing the topics.
message ListTopicsResponse {
  repeated Topic topics = 1;
}